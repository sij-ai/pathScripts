#!/usr/bin/env bash
set -Eeuo pipefail

# rerun <history_id>
# Prints the stored command for the given oh-my-zsh history ID,
# converting literal "\n" sequences into real newlines.

if [[ $# -ne 1 || ! "$1" =~ ^[0-9]+$ ]]; then
    echo "Usage: rerun <history_id>" >&2
    exit 64
fi

id="$1"

if ! command -v omz_history >/dev/null 2>&1; then
    echo "rerun: omz_history not found in PATH" >&2
    exit 127
fi

# Fetch the matching history line, which looks like: " 6610* <escaped-command-with-\n>"
line="$(omz_history | grep -E "^ *${id}\* " -m1 || true)"
if [[ -z "$line" ]]; then
    echo "rerun: no history entry found for id ${id}" >&2
    exit 1
fi

# Strip the leading " <id>* " prefix
content="$(printf '%s' "$line" | sed -E "s/^ *${id}\* //")"

# Interpret backslash escapes so "\n" becomes a real newline
printf '%b\n' "$content"

