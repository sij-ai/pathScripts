#!/usr/bin/env bash
set -Eeuo pipefail

# rerun <history_id>
# Prints the oh-my-zsh history entry for the given ID,
# converting literal "\n" sequences into real newlines.

if [[ $# -ne 1 || ! "$1" =~ ^[0-9]+$ ]]; then
    echo "Usage: rerun <history_id>" >&2
    exit 64
fi

id="$1"

if ! command -v zsh >/dev/null 2>&1; then
    echo "rerun: zsh not found" >&2
    exit 127
fi

# Run an interactive zsh so oh-my-zsh functions (omz_history) are available.
# Strip the leading " <id>* " prefix and return the rest of the line.
line="$(zsh -ic "omz_history | sed -n -E \"s/^ *${id}\* //p\" | head -n1" 2>/dev/null || true)"

if [[ -z "$line" ]]; then
    echo "rerun: no history entry found for id ${id}" >&2
    exit 1
fi

# Expand literal backslash-escaped sequences like \n to real newlines
printf '%b\n' "$line"

