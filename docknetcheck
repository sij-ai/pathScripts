#!/bin/bash

# Target subnet to check (Mailcowâ€™s default)
TARGET_SUBNET="172.22.1.0/24"

echo "Checking for Docker networks overlapping with $TARGET_SUBNET..."

# Get all network IDs and names
networks=$(docker network ls --format "{{.ID}} {{.Name}}")

# Loop through each network
while read -r net_id net_name; do
    # Inspect the network and extract subnets
    subnets=$(docker network inspect "$net_id" --format '{{range .IPAM.Config}}{{.Subnet}}{{end}}')
    
    # Check if TARGET_SUBNET is in the subnets
    if echo "$subnets" | grep -q "$TARGET_SUBNET"; then
        echo "Found overlap!"
        echo "Network: $net_name (ID: $net_id)"
        echo "Subnets: $subnets"
        echo "-----"
    fi
done <<< "$networks"

echo "Check complete."
